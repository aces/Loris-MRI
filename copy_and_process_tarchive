#!/bin/bash


 if [ $# -ne 5 ]  ##if site is not included

  then
        tarchive=$1
        mail_user=$2
        tarchive_location=$3
  else
       site=$1
       tarchive=$2
       mail_user=$3
       tarchive_location=$4
  fi

if [ -z "$tarchive" -o -z "$mail_user" ]
then
echo "Usage: $0 <tarchive> <mail_user>"
exit 1
fi


tempdir=$TMPDIR/load_tarchive_db.$$
mkdir -p $tempdir

# copy the tarchive from the study workstation to here
if
    cp $tarchive_location/$tarchive $tempdir/
# if the copy succeeded
then

# process the tarchive
uploadNeuroDB/tarchiveLoader -globLocation -profile prod $tempdir/`basename $tarchive`

# if the copy failed
else

# email the user
echo "Subject: SCP TARCHIVE FAILURE\nFailed to scp ${site} ${tarchive}"  | mail $mail_user

fi

rm -fr $tempdir
exit 0
